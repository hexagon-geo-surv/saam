// SPDX-FileCopyrightText: Leica Geosystems AG
//
// SPDX-License-Identifier: MIT

#pragma once

#include <version>

#define UNCHECKED 0
#define COUNTED 1
#define TRACKED 2

// If the mode is not defined from the compiler command line,
// then fall back to the mode coming from Conan option
#ifndef SAAM_BORROW_CHECKING_MODE
#define SAAM_BORROW_CHECKING_MODE @SAAM_BORROW_CHECKING_MODE_CMAKE@
#endif

#if SAAM_BORROW_CHECKING_MODE == COUNTED

#include <saam/detail/counted_borrow_manager.hpp>
namespace saam
{
using current_borrow_manager_t = counted_borrow_manager;
}

#elif SAAM_BORROW_CHECKING_MODE == TRACKED

#if !defined(__cpp_lib_stacktrace) || __cpp_lib_stacktrace < 202011L
    #error "<stacktrace> support is needed for tracked mode"
#endif

#include <saam/detail/tracked_borrow_manager.hpp>
namespace saam
{
using current_borrow_manager_t = tracked_borrow_manager;
}

#elif SAAM_BORROW_CHECKING_MODE == UNCHECKED

#include <saam/detail/unchecked_borrow_manager.hpp>
namespace saam
{
using current_borrow_manager_t = unchecked_borrow_manager;
}

#endif